<h1>Chapter 3: 类型全解</h1>
<p><code>unknown</code> 表示任何值，但是当进行特定操作前 ts 会要求细化类型</p>
<ol>
<li>ts 不会把任何值推导为 <code>unknown</code>，需要显式指定</li>
<li><code>unknown</code> 类型变量可以比较</li>
</ol>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='let a: unknown' >a</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">unknown</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='let b: boolean' >b</data-lsp></span><span style="color: #000000"> = </span><span style="color: #001080"><data-lsp lsp='let a: unknown' >a</data-lsp></span><span style="color: #000000"> === </span><span style="color: #098658">123</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='let c: any' >c</data-lsp></span><span style="color: #000000"> = </span><span style="color: #001080"><data-err><data-lsp lsp='let a: unknown' >a</data-lsp></data-err></span><span style="color: #000000"> + </span><span style="color: #098658">10</span><span style="color: #000000">;</span></div><span class="error"><span>Object is of type 'unknown'.</span><span class="code">2571</span></span><span class="error-behind">Object is of type 'unknown'.</span><div class='line'><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #0000FF">typeof</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='let a: unknown' >a</data-lsp></span><span style="color: #000000"> === </span><span style="color: #A31515">"number"</span><span style="color: #000000">) {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='let d: number' >d</data-lsp></span><span style="color: #000000"> = </span><span style="color: #001080"><data-lsp lsp='let a: number' >a</data-lsp></span><span style="color: #000000"> + </span><span style="color: #098658">10</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">}</span></div></code></div></pre>
<p>类型字面量：仅表示一个值的类型</p>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='let real: true' >real</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">true</span><span style="color: #000000"> = </span><span style="color: #0000FF">true</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='let exact: 1' >exact</data-lsp></span><span style="color: #000000">: </span><span style="color: #098658">1</span><span style="color: #000000"> = </span><span style="color: #098658">1</span><span style="color: #000000">;</span></div></code></div></pre>
<p><code>object</code> 类型表示一个非 <code>null</code> 的对象，但是对值得访问一无所知</p>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='let message: object' >message</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">object</span><span style="color: #000000"> = { </span><span style="color: #001080"><data-lsp lsp='(property) name: string' >name</data-lsp>:</span><span style="color: #000000"> </span><span style="color: #A31515">"hello"</span><span style="color: #000000"> };</span></div><div class='line'><span style="color: #001080"><data-lsp lsp='let message: object' >message</data-lsp></span><span style="color: #000000">.</span><span style="color: #001080"><data-err><data-lsp lsp='any' >name</data-lsp></data-err></span><span style="color: #000000">;</span></div><span class="error"><span>Property 'name' does not exist on type 'object'.</span><span class="code">2339</span></span><span class="error-behind">Property 'name' does not exist on type 'object'.</span></code></div></pre>
<p>class constructor 中的 <code>public</code> 是 <code>this.property = property</code> 的简写</p>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='class Person' >Person</data-lsp></span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #0000FF">constructor</span><span style="color: #000000">(</span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='(property) Person.name: string' >name</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">) {}</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #008000">// 等价于：</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #008000">// constructor(name: string) { this.name = name; }</span></div><div class='line'><span style="color: #000000">}</span></div></code></div></pre>
<p><code>{}</code> 和 <code>Object</code> 也可以用来声明对象类型，有细微差别，不推荐使用（P41）</p>
<p>类型别名使用块级作用域</p>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='function test(): void' >test</data-lsp></span><span style="color: #000000">() {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #0000FF">type</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='type Person = {&#10;    name: string;&#10;}' >Person</data-lsp></span><span style="color: #000000"> = { </span><span style="color: #001080"><data-lsp lsp='(property) name: string' >name</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000"> };</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #267F99"><data-lsp lsp='var Math: Math' >Math</data-lsp></span><span style="color: #000000">.</span><span style="color: #795E26"><data-lsp lsp='(method) Math.random(): number' >random</data-lsp></span><span style="color: #000000">() &gt; </span><span style="color: #098658">0.5</span><span style="color: #000000">) {</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #0000FF">type</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='type Person = {&#10;    age: number;&#10;}' >Person</data-lsp></span><span style="color: #000000"> = { </span><span style="color: #001080"><data-lsp lsp='(property) age: number' >age</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">number</span><span style="color: #000000"> };</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='let person: Person' >person</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='type Person = {&#10;    age: number;&#10;}' >Person</data-lsp></span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">  }</span></div><div class='line'><span style="color: #000000">}</span></div></code></div></pre>
<p>元组</p>
<ul>
<li>支持可选符号 ?</li>
<li>支持剩余元素 ...</li>
</ul>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='let ticket: [string, number]' >ticket</data-lsp></span><span style="color: #000000">: [</span><span style="color: #267F99">string</span><span style="color: #000000">, </span><span style="color: #267F99">number</span><span style="color: #000000">] = [</span><span style="color: #A31515">"bqh"</span><span style="color: #000000">, </span><span style="color: #098658">10185</span><span style="color: #000000">];</span></div><div class='line'><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='let trains: [string, (number | undefined)?][]' >trains</data-lsp></span><span style="color: #000000">: [</span><span style="color: #267F99">string</span><span style="color: #000000">, </span><span style="color: #267F99">number</span><span style="color: #000000">?][] = [[</span><span style="color: #A31515">"a"</span><span style="color: #000000">, </span><span style="color: #098658">123</span><span style="color: #000000">], [</span><span style="color: #A31515">"b"</span><span style="color: #000000">]];</span></div><div class='line'><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='let list: [number, boolean, ...string[]]' >list</data-lsp></span><span style="color: #000000">: [</span><span style="color: #267F99">number</span><span style="color: #000000">, </span><span style="color: #267F99">boolean</span><span style="color: #000000">, ...</span><span style="color: #267F99">string</span><span style="color: #000000">[]] = [</span><span style="color: #098658">1</span><span style="color: #000000">, </span><span style="color: #0000FF">true</span><span style="color: #000000">, </span><span style="color: #A31515">"a"</span><span style="color: #000000">, </span><span style="color: #A31515">"b"</span><span style="color: #000000">, </span><span style="color: #A31515">"c"</span><span style="color: #000000">];</span></div></code></div></pre>
<p>数组类型有 <code>readonly</code> 标识，只读数组不再能被改变</p>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='let arr: readonly number[]' >arr</data-lsp></span><span style="color: #000000">: </span><span style="color: #0000FF">readonly</span><span style="color: #000000"> </span><span style="color: #267F99">number</span><span style="color: #000000">[] = [</span><span style="color: #098658">1</span><span style="color: #000000">, </span><span style="color: #098658">2</span><span style="color: #000000">, </span><span style="color: #098658">3</span><span style="color: #000000">];</span></div><div class='line'><span style="color: #001080"><data-lsp lsp='let arr: readonly number[]' >arr</data-lsp></span><span style="color: #000000">[</span><span style="color: #098658">1</span><span style="color: #000000">] = </span><span style="color: #098658">2</span><span style="color: #000000">;</span></div><span class="error"><span>Index signature in type 'readonly number[]' only permits reading.</span><span class="code">2542</span></span><span class="error-behind">Index signature in type 'readonly number[]' only permits reading.</span><div class='line'><span style="color: #001080"><data-lsp lsp='let arr: readonly number[]' >arr</data-lsp></span><span style="color: #000000">.</span><span style="color: #795E26"><data-err><data-lsp lsp='any' >push</data-lsp></data-err></span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">);</span></div><span class="error"><span>Property 'push' does not exist on type 'readonly number[]'.</span><span class="code">2339</span></span><span class="error-behind">Property 'push' does not exist on type 'readonly number[]'.</span></code></div></pre>
<ul>
<li><code>void</code> 可表示无显式返回值函数的返回类型，例如 <code>console.log()</code></li>
<li><code>never</code> 可表示不会结束或抛出异常的的函数的返回类型</li>
<li><code>never</code> 值可以赋值给任何类型的变量</li>
</ul>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='function error(message: string): never' >error</data-lsp></span><span style="color: #000000">(</span><span style="color: #001080"><data-lsp lsp='(parameter) message: string' >message</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">): </span><span style="color: #267F99">never</span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #AF00DB">throw</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='var Error: ErrorConstructor&#10;new (message?: string | undefined) => Error' >Error</data-lsp></span><span style="color: #000000">(</span><span style="color: #A31515">&apos;Failed to return. msg:&apos;</span><span style="color: #000000"> + </span><span style="color: #001080"><data-lsp lsp='(parameter) message: string' >message</data-lsp></span><span style="color: #000000">);</span></div><div class='line'><span style="color: #000000">}</span></div><div class='line'><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='function loop(): never' >loop</data-lsp></span><span style="color: #000000">(): </span><span style="color: #267F99">never</span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #AF00DB">while</span><span style="color: #000000"> (</span><span style="color: #0000FF">true</span><span style="color: #000000">) {}</span></div><div class='line'><span style="color: #000000">}</span></div><div class='line'><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='let sth: number' >sth</data-lsp></span><span style="color: #000000"> = </span><span style="color: #098658">100</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #001080"><data-lsp lsp='let sth: number' >sth</data-lsp></span><span style="color: #000000"> = </span><span style="color: #795E26"><data-lsp lsp='function loop(): never' >loop</data-lsp></span><span style="color: #000000">();</span></div></code></div></pre>
<p>枚举</p>
<ul>
<li><code>enum</code> 编译为一个对象a</li>
<li><code>const enum</code> 则不生成 JavaScript 代码，而是在用到枚举成员的地方内插对应的值，</li>
<li>设置 <code>complierOptions</code> 中的 <code>preserveConstEnums</code> 参数为 true 可以保留枚举常量（Disable erasing <code>const enum</code> declarations in generated code.）</li>
</ul>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">enum</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='enum Color' >Color</data-lsp></span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #0070C1"><data-lsp lsp='(enum member) Color.Red = "#f00"' >Red</data-lsp></span><span style="color: #000000"> = </span><span style="color: #A31515">"#f00"</span><span style="color: #000000">,</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #0070C1"><data-lsp lsp='(enum member) Color.Green = "#0f0"' >Green</data-lsp></span><span style="color: #000000"> = </span><span style="color: #A31515">"#0f0"</span><span style="color: #000000">,</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #0070C1"><data-lsp lsp='(enum member) Color.Blue = "#00f"' >Blue</data-lsp></span><span style="color: #000000"> = </span><span style="color: #A31515">"#00f"</span><span style="color: #000000">,</span></div><div class='line'><span style="color: #000000">}</span></div><div class='line'><span style="color: #008000">// 编译结果：</span></div><div class='line'><span style="color: #008000">// var Color;</span></div><div class='line'><span style="color: #008000">// (function (Color) {</span></div><div class='line'><span style="color: #008000">//     Color["Red"] = "#f00";</span></div><div class='line'><span style="color: #008000">//     Color["Green"] = "#0f0";</span></div><div class='line'><span style="color: #008000">//     Color["Blue"] = "#00f";</span></div><div class='line'><span style="color: #008000">// })(Color || (Color = {}));</span></div></code></div></pre>