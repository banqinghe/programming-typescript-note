<h1>Chapter 5: 类和接口</h1>
<p>关键词：</p>
<ul>
<li><code>public</code> / <code>private</code> / <code>protected</code></li>
<li><code>readonly</code></li>
<li><code>abstract</code></li>
</ul>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='class Piece' >Piece</data-lsp></span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000"> </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='(property) Piece.position: {&#10;    x: number;&#10;    y: number;&#10;}' >position</data-lsp></span><span style="color: #000000">: { </span><span style="color: #001080"><data-lsp lsp='(property) x: number' >x</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">number</span><span style="color: #000000">; </span><span style="color: #001080"><data-lsp lsp='(property) y: number' >y</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">number</span><span style="color: #000000"> };</span></div><div class='line'><span style="color: #000000"> </span><span style="color: #0000FF">constructor</span><span style="color: #000000">(</span><span style="color: #0000FF">private</span><span style="color: #000000"> </span><span style="color: #0000FF">readonly</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='(property) Piece.color: string' >color</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">) {</span></div><div class='line'><span style="color: #000000">   </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080"><data-lsp lsp='(property) Piece.position: {&#10;    x: number;&#10;    y: number;&#10;}' >position</data-lsp></span><span style="color: #000000"> = { </span><span style="color: #001080"><data-lsp lsp='(property) x: number' >x</data-lsp>:</span><span style="color: #000000"> </span><span style="color: #098658">0</span><span style="color: #000000">, </span><span style="color: #001080"><data-lsp lsp='(property) y: number' >y</data-lsp>:</span><span style="color: #000000"> </span><span style="color: #098658">0</span><span style="color: #000000"> };</span></div><div class='line'><span style="color: #000000"> }</span></div><div class='line'><span style="color: #000000">}</span></div><div class='line'><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1"><data-lsp lsp='const piece: Piece' >piece</data-lsp></span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='constructor Piece(color: string): Piece' >Piece</data-lsp></span><span style="color: #000000">(</span><span style="color: #A31515">"red"</span><span style="color: #000000">);</span></div></code></div></pre>
<p><code>type</code> 和 <code>interface</code> 是同一概念的两种句法，但有细微区别（P114）</p>
<ol>
<li>type 更通用，interface 则必须为结构</li>
<li>interface 扩展时会检查是否可赋值，type 则不会</li>
<li>同一命名空间下的同名 interface 会合并，type 则会导致冲突</li>
</ol>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">type</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='type Char = "a" | "b" | "c"' >Char</data-lsp></span><span style="color: #000000"> = </span><span style="color: #A31515">"a"</span><span style="color: #000000"> | </span><span style="color: #A31515">"b"</span><span style="color: #000000"> | </span><span style="color: #A31515">"c"</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #008000">// interface IChar = &apos;a&apos; | &apos;b&apos; | &apos;c&apos;;  -&gt; error</span></div><div class='line'><span style="color: #0000FF">interface</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='interface InterfaceA' >InterfaceA</data-lsp></span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #001080"><data-lsp lsp='(property) InterfaceA.value: string' >value</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">}</span></div><div class='line'><span style="color: #008000">// error</span></div><div class='line'><span style="color: #0000FF">interface</span><span style="color: #000000"> </span><span style="color: #267F99"><data-err><data-lsp lsp='interface InterfaceB' >InterfaceB</data-lsp></data-err></span><span style="color: #000000"> </span><span style="color: #0000FF">extends</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='interface InterfaceA' >InterfaceA</data-lsp></span><span style="color: #000000"> {</span></div><span class="error"><span>Interface 'InterfaceB' incorrectly extends interface 'InterfaceA'.
  Types of property 'value' are incompatible.
    Type 'number' is not assignable to type 'string'.</span><span class="code">2430</span></span><span class="error-behind">Interface 'InterfaceB' incorrectly extends interface 'InterfaceA'.
  Types of property 'value' are incompatible.
    Type 'number' is not assignable to type 'string'.</span><div class='line'><span style="color: #000000">  </span><span style="color: #001080"><data-lsp lsp='(property) InterfaceB.value: number' >value</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">number</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">}</span></div><div class='line'><span style="color: #008000">// 两个 InterfaceA 并不冲突，而是会合并</span></div><div class='line'><span style="color: #0000FF">interface</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='interface InterfaceA' >InterfaceA</data-lsp></span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #001080"><data-lsp lsp='(property) InterfaceA.name: string' >name</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">}</span></div></code></div></pre>
<p><code>interface</code> 也可以 <code>readonly</code>，但是不可以有 <code>public</code> / <code>private</code> / <code>protected</code> 修饰符</p>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">interface</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='interface Animal' >Animal</data-lsp></span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #0000FF">readonly</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='(property) Animal.name: string' >name</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">}</span></div><div class='line'><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1"><data-lsp lsp='const cat: Animal' >cat</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='interface Animal' >Animal</data-lsp></span><span style="color: #000000"> = { </span><span style="color: #001080"><data-lsp lsp='(property) Animal.name: string' >name</data-lsp>:</span><span style="color: #000000"> </span><span style="color: #A31515">"cat"</span><span style="color: #000000"> };</span></div><div class='line'><span style="color: #001080"><data-lsp lsp='const cat: Animal' >cat</data-lsp></span><span style="color: #000000">.</span><span style="color: #001080"><data-err><data-lsp lsp='(property) Animal.name: any' >name</data-lsp></data-err></span><span style="color: #000000"> = </span><span style="color: #A31515">""</span><span style="color: #000000">;</span></div><span class="error"><span>Cannot assign to 'name' because it is a read-only property.</span><span class="code">2540</span></span><span class="error-behind">Cannot assign to 'name' because it is a read-only property.</span></code></div></pre>
<p>值和类型位于不同的命名空间中，不会冲突</p>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='let value: string' >value</data-lsp></span><span style="color: #000000"> = </span><span style="color: #A31515">"1"</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #0000FF">type</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='type value = string' >value</data-lsp></span><span style="color: #000000"> = </span><span style="color: #267F99">string</span><span style="color: #000000">;</span></div></code></div></pre>
<p>类声明会在类空间生成两个声明（P123）</p>
<ol>
<li>类的实例类型</li>
<li>类的构造方法类型，<code>keyof</code> ClassName 获得</li>
</ol>
<p>typeof 运算符还需要继续学习</p>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">type</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='type State = {&#10;    [key: string]: string;&#10;}' >State</data-lsp></span><span style="color: #000000"> = {</span></div><div class='line'><span style="color: #000000">  [</span><span style="color: #001080"><data-lsp lsp='(parameter) key: string' >key</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">]: </span><span style="color: #267F99">string</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">};</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='class StringDataBase' >StringDataBase</data-lsp></span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #001080"><data-lsp lsp='(property) StringDataBase.state: State' >state</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='type State = {&#10;    [key: string]: string;&#10;}' >State</data-lsp></span><span style="color: #000000"> = {};</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #008000">// get 无法推导出返回值可能是 null (why?)，手动声明返回值类型</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #795E26"><data-lsp lsp='(method) StringDataBase.get(key: string): string | null' >get</data-lsp></span><span style="color: #000000">(</span><span style="color: #001080"><data-lsp lsp='(parameter) key: string' >key</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">): </span><span style="color: #267F99">string</span><span style="color: #000000"> | </span><span style="color: #267F99">null</span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080"><data-lsp lsp='(property) StringDataBase.state: State' >state</data-lsp></span><span style="color: #000000">[</span><span style="color: #001080"><data-lsp lsp='(parameter) key: string' >key</data-lsp></span><span style="color: #000000">] || </span><span style="color: #0000FF">null</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">  }</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #795E26"><data-lsp lsp='(method) StringDataBase.set(key: string, value: string): void' >set</data-lsp></span><span style="color: #000000">(</span><span style="color: #001080"><data-lsp lsp='(parameter) key: string' >key</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">, </span><span style="color: #001080"><data-lsp lsp='(parameter) value: string' >value</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">) {</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080"><data-lsp lsp='(property) StringDataBase.state: State' >state</data-lsp></span><span style="color: #000000">[</span><span style="color: #001080"><data-lsp lsp='(parameter) key: string' >key</data-lsp></span><span style="color: #000000">] = </span><span style="color: #001080"><data-lsp lsp='(parameter) value: string' >value</data-lsp></span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">  }</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #0000FF">static</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='(method) StringDataBase.from(state: State): StringDataBase' >from</data-lsp></span><span style="color: #000000">(</span><span style="color: #001080"><data-lsp lsp='(parameter) state: State' >state</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='type State = {&#10;    [key: string]: string;&#10;}' >State</data-lsp></span><span style="color: #000000">) {</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1"><data-lsp lsp='const db: StringDataBase' >db</data-lsp></span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='constructor StringDataBase(): StringDataBase' >StringDataBase</data-lsp></span><span style="color: #000000">();</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #001080"><data-lsp lsp='const db: StringDataBase' >db</data-lsp></span><span style="color: #000000">.</span><span style="color: #001080"><data-lsp lsp='(property) StringDataBase.state: State' >state</data-lsp></span><span style="color: #000000"> = </span><span style="color: #001080"><data-lsp lsp='(parameter) state: State' >state</data-lsp></span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='const db: StringDataBase' >db</data-lsp></span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">  }</span></div><div class='line'><span style="color: #000000">}</span></div><div class='line'><span style="color: #008000">// type StringDataBaseType = typeof StringDataBase;</span></div></code></div></pre>
<p>Exercise 4（GitHub 上的答案）:</p>
<p>4 . [Hard] As an exercise, think about how you might design a typesafe builder pattern.
Extend the Builder pattern Builder Pattern example from earlier in this chapter to:</p>
<p>4a. Guarantee at compile time that someone can’t call .send() before setting at least URL
and method. Would it be easier to make this guarantee if you also force the user to call
methods in a specific order? (Hint: what can you return instead of this?)</p>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='class RequestBuilder' >RequestBuilder</data-lsp></span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #0000FF">protected</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='(property) RequestBuilder.data: object | null' >data</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">object</span><span style="color: #000000"> | </span><span style="color: #267F99">null</span><span style="color: #000000"> = </span><span style="color: #0000FF">null</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #0000FF">protected</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='(property) RequestBuilder.method: "get" | "post" | null' >method</data-lsp></span><span style="color: #000000">: </span><span style="color: #A31515">"get"</span><span style="color: #000000"> | </span><span style="color: #A31515">"post"</span><span style="color: #000000"> | </span><span style="color: #267F99">null</span><span style="color: #000000"> = </span><span style="color: #0000FF">null</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #0000FF">protected</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='(property) RequestBuilder.url: string | null' >url</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000"> | </span><span style="color: #267F99">null</span><span style="color: #000000"> = </span><span style="color: #0000FF">null</span><span style="color: #000000">;</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #000000">  </span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilder.setMethod(method: "get" | "post"): RequestBuilderWithMethod' >setMethod</data-lsp></span><span style="color: #000000">(</span><span style="color: #001080"><data-lsp lsp='(parameter) method: "get" | "post"' >method</data-lsp></span><span style="color: #000000">: </span><span style="color: #A31515">"get"</span><span style="color: #000000"> | </span><span style="color: #A31515">"post"</span><span style="color: #000000">): </span><span style="color: #267F99"><data-lsp lsp='class RequestBuilderWithMethod' >RequestBuilderWithMethod</data-lsp></span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='constructor RequestBuilderWithMethod(): RequestBuilderWithMethod' >RequestBuilderWithMethod</data-lsp></span><span style="color: #000000">().</span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilderWithMethod.setMethod(method: "get" | "post" | null): RequestBuilderWithMethod' >setMethod</data-lsp></span><span style="color: #000000">(</span><span style="color: #001080"><data-lsp lsp='(parameter) method: "get" | "post"' >method</data-lsp></span><span style="color: #000000">).</span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilder.setData(data: object | null): RequestBuilderWithMethod' >setData</data-lsp></span><span style="color: #000000">(</span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080"><data-lsp lsp='(property) RequestBuilder.data: object | null' >data</data-lsp></span><span style="color: #000000">);</span></div><div class='line'><span style="color: #000000">  }</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilder.setData(data: object | null): this' >setData</data-lsp></span><span style="color: #000000">(</span><span style="color: #001080"><data-lsp lsp='(parameter) data: object | null' >data</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">object</span><span style="color: #000000"> | </span><span style="color: #267F99">null</span><span style="color: #000000">): </span><span style="color: #267F99">this</span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080"><data-lsp lsp='(property) RequestBuilder.data: object | null' >data</data-lsp></span><span style="color: #000000"> = </span><span style="color: #001080"><data-lsp lsp='(parameter) data: object | null' >data</data-lsp></span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #0000FF">this</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">  }</span></div><div class='line'><span style="color: #000000">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='class RequestBuilderWithMethod' >RequestBuilderWithMethod</data-lsp></span><span style="color: #000000"> </span><span style="color: #0000FF">extends</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='class RequestBuilder' >RequestBuilder</data-lsp></span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilderWithMethod.setMethod(method: "get" | "post" | null): this' >setMethod</data-lsp></span><span style="color: #000000">(</span><span style="color: #001080"><data-lsp lsp='(parameter) method: "get" | "post" | null' >method</data-lsp></span><span style="color: #000000">: </span><span style="color: #A31515">"get"</span><span style="color: #000000"> | </span><span style="color: #A31515">"post"</span><span style="color: #000000"> | </span><span style="color: #267F99">null</span><span style="color: #000000">): </span><span style="color: #267F99">this</span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080"><data-lsp lsp='(property) RequestBuilder.method: "get" | "post" | null' >method</data-lsp></span><span style="color: #000000"> = </span><span style="color: #001080"><data-lsp lsp='(parameter) method: "get" | "post" | null' >method</data-lsp></span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #0000FF">this</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">  }</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilderWithMethod.setURL(url: string): RequestBuilderWithMethodAndURL' >setURL</data-lsp></span><span style="color: #000000">(</span><span style="color: #001080"><data-lsp lsp='(parameter) url: string' >url</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">): </span><span style="color: #267F99"><data-lsp lsp='class RequestBuilderWithMethodAndURL' >RequestBuilderWithMethodAndURL</data-lsp></span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='constructor RequestBuilderWithMethodAndURL(): RequestBuilderWithMethodAndURL' >RequestBuilderWithMethodAndURL</data-lsp></span><span style="color: #000000">()</span></div><div class='line'><span style="color: #000000">      .</span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilderWithMethod.setMethod(method: "get" | "post" | null): RequestBuilderWithMethodAndURL' >setMethod</data-lsp></span><span style="color: #000000">(</span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080"><data-lsp lsp='(property) RequestBuilder.method: "get" | "post" | null' >method</data-lsp></span><span style="color: #000000">)</span></div><div class='line'><span style="color: #000000">      .</span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilderWithMethodAndURL.setURL(url: string): RequestBuilderWithMethodAndURL' >setURL</data-lsp></span><span style="color: #000000">(</span><span style="color: #001080"><data-lsp lsp='(parameter) url: string' >url</data-lsp></span><span style="color: #000000">)</span></div><div class='line'><span style="color: #000000">      .</span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilder.setData(data: object | null): RequestBuilderWithMethodAndURL' >setData</data-lsp></span><span style="color: #000000">(</span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080"><data-lsp lsp='(property) RequestBuilder.data: object | null' >data</data-lsp></span><span style="color: #000000">);</span></div><div class='line'><span style="color: #000000">  }</span></div><div class='line'><span style="color: #000000">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='class RequestBuilderWithMethodAndURL' >RequestBuilderWithMethodAndURL</data-lsp></span><span style="color: #000000"> </span><span style="color: #0000FF">extends</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='class RequestBuilderWithMethod' >RequestBuilderWithMethod</data-lsp></span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilderWithMethodAndURL.setURL(url: string): this' >setURL</data-lsp></span><span style="color: #000000">(</span><span style="color: #001080"><data-lsp lsp='(parameter) url: string' >url</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">): </span><span style="color: #267F99">this</span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080"><data-lsp lsp='(property) RequestBuilder.url: string | null' >url</data-lsp></span><span style="color: #000000"> = </span><span style="color: #001080"><data-lsp lsp='(parameter) url: string' >url</data-lsp></span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #0000FF">this</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">  }</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilderWithMethodAndURL.send(): void' >send</data-lsp></span><span style="color: #000000">() {</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #008000">// ...</span></div><div class='line'><span style="color: #000000">  }</span></div><div class='line'><span style="color: #000000">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='constructor RequestBuilder(): RequestBuilder' >RequestBuilder</data-lsp></span><span style="color: #000000">().</span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilder.setMethod(method: "get" | "post"): RequestBuilderWithMethod' >setMethod</data-lsp></span><span style="color: #000000">(</span><span style="color: #A31515">"get"</span><span style="color: #000000">).</span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilder.setData(data: object | null): this' >setData</data-lsp></span><span style="color: #000000">({}).</span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilderWithMethod.setURL(url: string): RequestBuilderWithMethodAndURL' >setURL</data-lsp></span><span style="color: #000000">(</span><span style="color: #A31515">"foo.com"</span><span style="color: #000000">).</span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilderWithMethodAndURL.send(): void' >send</data-lsp></span><span style="color: #000000">();</span></div></code></div></pre>
<p>4b. [Harder] How would you change your design if you wanted to make this guarantee, but still let people call methods in any order?</p>
<p>(This answer courtesy of @albertywu)</p>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">interface</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='interface BuildableRequest' >BuildableRequest</data-lsp></span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #001080"><data-lsp lsp='(property) BuildableRequest.data?: object | undefined' >data</data-lsp></span><span style="color: #000000">?: </span><span style="color: #267F99">object</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #001080"><data-lsp lsp='(property) BuildableRequest.method: "get" | "post"' >method</data-lsp></span><span style="color: #000000">: </span><span style="color: #A31515">"get"</span><span style="color: #000000"> | </span><span style="color: #A31515">"post"</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #001080"><data-lsp lsp='(property) BuildableRequest.url: string' >url</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='class RequestBuilder2' >RequestBuilder2</data-lsp></span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #001080"><data-lsp lsp='(property) RequestBuilder2.data?: object | undefined' >data</data-lsp></span><span style="color: #000000">?: </span><span style="color: #267F99">object</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #001080"><data-lsp lsp='(property) RequestBuilder2.method?: "get" | "post" | undefined' >method</data-lsp></span><span style="color: #000000">?: </span><span style="color: #A31515">"get"</span><span style="color: #000000"> | </span><span style="color: #A31515">"post"</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #001080"><data-lsp lsp='(property) RequestBuilder2.url?: string | undefined' >url</data-lsp></span><span style="color: #000000">?: </span><span style="color: #267F99">string</span><span style="color: #000000">;</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #000000">  </span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilder2.setData(data: object): this &amp; Pick&lt;BuildableRequest, "data">' >setData</data-lsp></span><span style="color: #000000">(</span><span style="color: #001080"><data-lsp lsp='(parameter) data: object' >data</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">object</span><span style="color: #000000">): </span><span style="color: #267F99">this</span><span style="color: #000000"> & </span><span style="color: #267F99"><data-lsp lsp='type Pick&lt;T, K extends keyof T> = { [P in K]: T[P]; }' >Pick</data-lsp></span><span style="color: #000000">&lt;</span><span style="color: #267F99"><data-lsp lsp='interface BuildableRequest' >BuildableRequest</data-lsp></span><span style="color: #000000">, </span><span style="color: #A31515">"data"</span><span style="color: #000000">&gt; {</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='var Object: ObjectConstructor' >Object</data-lsp></span><span style="color: #000000">.</span><span style="color: #795E26"><data-lsp lsp='(method) ObjectConstructor.assign&lt;this, {&#10;    data: object;&#10;}>(target: this, source: {&#10;    data: object;&#10;}): this &amp; {&#10;    data: object;&#10;} (+3 overloads)' >assign</data-lsp></span><span style="color: #000000">(</span><span style="color: #0000FF">this</span><span style="color: #000000">, { </span><span style="color: #001080"><data-lsp lsp='(property) data: object' >data</data-lsp></span><span style="color: #000000"> });</span></div><div class='line'><span style="color: #000000">  }</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #000000">  </span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilder2.setMethod(method: "get" | "post"): this &amp; Pick&lt;BuildableRequest, "method">' >setMethod</data-lsp></span><span style="color: #000000">(</span><span style="color: #001080"><data-lsp lsp='(parameter) method: "get" | "post"' >method</data-lsp></span><span style="color: #000000">: </span><span style="color: #A31515">"get"</span><span style="color: #000000"> | </span><span style="color: #A31515">"post"</span><span style="color: #000000">): </span><span style="color: #267F99">this</span><span style="color: #000000"> & </span><span style="color: #267F99"><data-lsp lsp='type Pick&lt;T, K extends keyof T> = { [P in K]: T[P]; }' >Pick</data-lsp></span><span style="color: #000000">&lt;</span><span style="color: #267F99"><data-lsp lsp='interface BuildableRequest' >BuildableRequest</data-lsp></span><span style="color: #000000">, </span><span style="color: #A31515">"method"</span><span style="color: #000000">&gt; {</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='var Object: ObjectConstructor' >Object</data-lsp></span><span style="color: #000000">.</span><span style="color: #795E26"><data-lsp lsp='(method) ObjectConstructor.assign&lt;this, {&#10;    method: "get" | "post";&#10;}>(target: this, source: {&#10;    method: "get" | "post";&#10;}): this &amp; {&#10;    method: "get" | "post";&#10;} (+3 overloads)' >assign</data-lsp></span><span style="color: #000000">(</span><span style="color: #0000FF">this</span><span style="color: #000000">, { </span><span style="color: #001080"><data-lsp lsp='(property) method: "get" | "post"' >method</data-lsp></span><span style="color: #000000"> });</span></div><div class='line'><span style="color: #000000">  }</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #000000">  </span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilder2.setURL(url: string): this &amp; Pick&lt;BuildableRequest, "url">' >setURL</data-lsp></span><span style="color: #000000">(</span><span style="color: #001080"><data-lsp lsp='(parameter) url: string' >url</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">): </span><span style="color: #267F99">this</span><span style="color: #000000"> & </span><span style="color: #267F99"><data-lsp lsp='type Pick&lt;T, K extends keyof T> = { [P in K]: T[P]; }' >Pick</data-lsp></span><span style="color: #000000">&lt;</span><span style="color: #267F99"><data-lsp lsp='interface BuildableRequest' >BuildableRequest</data-lsp></span><span style="color: #000000">, </span><span style="color: #A31515">"url"</span><span style="color: #000000">&gt; {</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='var Object: ObjectConstructor' >Object</data-lsp></span><span style="color: #000000">.</span><span style="color: #795E26"><data-lsp lsp='(method) ObjectConstructor.assign&lt;this, {&#10;    url: string;&#10;}>(target: this, source: {&#10;    url: string;&#10;}): this &amp; {&#10;    url: string;&#10;} (+3 overloads)' >assign</data-lsp></span><span style="color: #000000">(</span><span style="color: #0000FF">this</span><span style="color: #000000">, { </span><span style="color: #001080"><data-lsp lsp='(property) url: string' >url</data-lsp></span><span style="color: #000000"> });</span></div><div class='line'><span style="color: #000000">  }</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #000000">  </span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilder2.build(this: BuildableRequest): BuildableRequest' >build</data-lsp></span><span style="color: #000000">(</span><span style="color: #0000FF"><data-lsp lsp='(parameter) this: BuildableRequest' >this</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='interface BuildableRequest' >BuildableRequest</data-lsp></span><span style="color: #000000">) {</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #0000FF">this</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">  }</span></div><div class='line'><span style="color: #000000">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='constructor RequestBuilder2(): RequestBuilder2' >RequestBuilder2</data-lsp></span><span style="color: #000000">()</span></div><div class='line'><span style="color: #000000">  .</span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilder2.setMethod(method: "get" | "post"): RequestBuilder2 &amp; Pick&lt;BuildableRequest, "method">' >setMethod</data-lsp></span><span style="color: #000000">(</span><span style="color: #A31515">"post"</span><span style="color: #000000">) </span><span style="color: #008000">// Try removing me!</span></div><div class='line'><span style="color: #000000">  .</span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilder2.setURL(url: string): RequestBuilder2 &amp; Pick&lt;BuildableRequest, "method"> &amp; Pick&lt;BuildableRequest, "url">' >setURL</data-lsp></span><span style="color: #000000">(</span><span style="color: #A31515">"bar"</span><span style="color: #000000">) </span><span style="color: #008000">// Try removing me!</span></div><div class='line'><span style="color: #000000">  .</span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilder2.setData(data: object): RequestBuilder2 &amp; Pick&lt;BuildableRequest, "method"> &amp; Pick&lt;BuildableRequest, "url"> &amp; Pick&lt;BuildableRequest, "data">' >setData</data-lsp></span><span style="color: #000000">({})</span></div><div class='line'><span style="color: #000000">  .</span><span style="color: #795E26"><data-lsp lsp='(method) RequestBuilder2.build(this: BuildableRequest): BuildableRequest' >build</data-lsp></span><span style="color: #000000">();</span></div></code></div></pre>