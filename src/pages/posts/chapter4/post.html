<h1>Chapter 4: 函数</h1>
<p>当需要在函数中使用 <code>this</code> 时，可以在参数列表的第一项声明 <code>this</code> 的类型，否则 <code>this</code> 为 <code>any</code>，并不安全</p>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='function helloDate(this: Date, greet: string): string' >helloDate</data-lsp></span><span style="color: #000000">(</span><span style="color: #0000FF"><data-lsp lsp='(parameter) this: Date' >this</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='interface Date' >Date</data-lsp></span><span style="color: #000000">, </span><span style="color: #001080"><data-lsp lsp='(parameter) greet: string' >greet</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">) {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='(parameter) greet: string' >greet</data-lsp></span><span style="color: #000000"> + </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #795E26"><data-lsp lsp='(method) Date.getDate(): number' >getDate</data-lsp></span><span style="color: #000000">();</span></div><div class='line'><span style="color: #000000">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #008000">// error</span></div><div class='line'><span style="color: #795E26"><data-lsp lsp='function helloDate(this: Date, greet: string): string' >helloDate</data-lsp></span><span style="color: #000000">(</span><span style="color: #A31515">&apos;hello&apos;</span><span style="color: #000000">);</span></div><span class="error"><span>The 'this' context of type 'void' is not assignable to method's 'this' of type 'Date'.</span><span class="code">2684</span></span><span class="error-behind">The 'this' context of type 'void' is not assignable to method's 'this' of type 'Date'.</span><div class='line'><span style="color: #001080"><data-lsp lsp='function helloDate(this: Date, greet: string): string' >helloDate</data-lsp></span><span style="color: #000000">.</span><span style="color: #795E26"><data-lsp lsp='(method) CallableFunction.call&lt;Date, [string], string>(this: (this: Date, args_0: string) => string, thisArg: Date, args_0: string): string' >call</data-lsp></span><span style="color: #000000">(<data-err>{}</data-err>, </span><span style="color: #A31515">"hello"</span><span style="color: #000000">);</span></div><span class="error"><span>Argument of type '{}' is not assignable to parameter of type 'Date'.
  Type '{}' is missing the following properties from type 'Date': toDateString, toTimeString, toLocaleDateString, toLocaleTimeString, and 38 more.</span><span class="code">2345</span></span><span class="error-behind">Argument of type '{}' is not assignable to parameter of type 'Date'.
  Type '{}' is missing the following properties from type 'Date': toDateString, toTimeString, toLocaleDateString, toLocaleTimeString, and 38 more.</span><div class='line'>&nbsp;</div><div class='line'><span style="color: #008000">// correct</span></div><div class='line'><span style="color: #001080"><data-lsp lsp='function helloDate(this: Date, greet: string): string' >helloDate</data-lsp></span><span style="color: #000000">.</span><span style="color: #795E26"><data-lsp lsp='(method) CallableFunction.call&lt;Date, [string], string>(this: (this: Date, args_0: string) => string, thisArg: Date, args_0: string): string' >call</data-lsp></span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='var Date: DateConstructor&#10;new () => Date (+4 overloads)' >Date</data-lsp></span><span style="color: #000000">(), </span><span style="color: #A31515">"hello"</span><span style="color: #000000">);</span></div></code></div></pre>
<p>函数类型有两种声明方式，分别为简写和完整形式</p>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #008000">// The following two declare are the same</span></div><div class='line'><span style="color: #0000FF">type</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='type LogA = (message: string) => void' >LogA</data-lsp></span><span style="color: #000000"> = (</span><span style="color: #001080"><data-lsp lsp='(parameter) message: string' >message</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #267F99">void</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #0000FF">type</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='type LogB = (message: string) => void' >LogB</data-lsp></span><span style="color: #000000"> = {</span></div><div class='line'><span style="color: #000000">  (</span><span style="color: #001080"><data-lsp lsp='(parameter) message: string' >message</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">): </span><span style="color: #267F99">void</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">};</span></div></code></div></pre>
<p>函数类型的完整声明可以用来进行函数的重载</p>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">type</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='type Print = {&#10;    (message: string): void;&#10;    (message: string, suffix: number): number;&#10;    (prefix: number, message: string, suffix: number): number;&#10;}' >Print</data-lsp></span><span style="color: #000000"> = {</span></div><div class='line'><span style="color: #000000">  (</span><span style="color: #001080"><data-lsp lsp='(parameter) message: string' >message</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">): </span><span style="color: #267F99">void</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">  (</span><span style="color: #001080"><data-lsp lsp='(parameter) message: string' >message</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">, </span><span style="color: #001080"><data-lsp lsp='(parameter) suffix: number' >suffix</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">number</span><span style="color: #000000">): </span><span style="color: #267F99">number</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">  (</span><span style="color: #001080"><data-lsp lsp='(parameter) prefix: number' >prefix</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">number</span><span style="color: #000000">, </span><span style="color: #001080"><data-lsp lsp='(parameter) message: string' >message</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">, </span><span style="color: #001080"><data-lsp lsp='(parameter) suffix: number' >suffix</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">number</span><span style="color: #000000">): </span><span style="color: #267F99">number</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">};</span></div></code></div></pre>
<p>可以在函数声明时对函数进行重载</p>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='function foo(message: "a"): Date (+2 overloads)' >foo</data-lsp></span><span style="color: #000000">(</span><span style="color: #001080"><data-lsp lsp='(parameter) message: "a"' >message</data-lsp></span><span style="color: #000000">: </span><span style="color: #A31515">"a"</span><span style="color: #000000">): </span><span style="color: #267F99"><data-lsp lsp='interface Date' >Date</data-lsp></span><span style="color: #000000">;</span></div><div class='line'><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='function foo(message: "b"): number (+2 overloads)' >foo</data-lsp></span><span style="color: #000000">(</span><span style="color: #001080"><data-lsp lsp='(parameter) message: "b"' >message</data-lsp></span><span style="color: #000000">: </span><span style="color: #A31515">"b"</span><span style="color: #000000">): </span><span style="color: #267F99">number</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='function foo(name: "c"): string (+2 overloads)' >foo</data-lsp></span><span style="color: #000000">(</span><span style="color: #001080"><data-lsp lsp='(parameter) name: "c"' >name</data-lsp></span><span style="color: #000000">: </span><span style="color: #A31515">"c"</span><span style="color: #000000">): </span><span style="color: #267F99">string</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='function foo(message: "a"): Date (+2 overloads)' >foo</data-lsp></span><span style="color: #000000">(</span><span style="color: #001080"><data-lsp lsp='(parameter) message: string' >message</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">): </span><span style="color: #267F99">any</span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='(parameter) message: string' >message</data-lsp></span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">}</span></div></code></div></pre>
<p>使用完整的函数类型声明可以给函数对象添加属性</p>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">type</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='type FooFn = {&#10;    (message: string): void;&#10;    bar: number;&#10;}' >FooFn</data-lsp></span><span style="color: #000000"> = {</span></div><div class='line'><span style="color: #000000">  (</span><span style="color: #001080"><data-lsp lsp='(parameter) message: string' >message</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">): </span><span style="color: #267F99">void</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #001080"><data-lsp lsp='(property) bar: number' >bar</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">number</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">};</span></div></code></div></pre>
<p>泛型</p>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #008000">// A example for filter function</span></div><div class='line'><span style="color: #0000FF">type</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='type Filter = &lt;T>(array: T[], f: (item: T) => boolean) => T[]' >Filter</data-lsp></span><span style="color: #000000"> = {</span></div><div class='line'><span style="color: #000000">  &lt;</span><span style="color: #267F99"><data-lsp lsp='(type parameter) T in &lt;T>(array: T[], f: (item: T) => boolean): T[]' >T</data-lsp></span><span style="color: #000000">&gt;(</span><span style="color: #001080"><data-lsp lsp='(parameter) array: T[]' >array</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='(type parameter) T in &lt;T>(array: T[], f: (item: T) => boolean): T[]' >T</data-lsp></span><span style="color: #000000">[], </span><span style="color: #795E26"><data-lsp lsp='(parameter) f: (item: T) => boolean' >f</data-lsp></span><span style="color: #000000">: (</span><span style="color: #001080"><data-lsp lsp='(parameter) item: T' >item</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='(type parameter) T in &lt;T>(array: T[], f: (item: T) => boolean): T[]' >T</data-lsp></span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #267F99">boolean</span><span style="color: #000000">): </span><span style="color: #267F99"><data-lsp lsp='(type parameter) T in &lt;T>(array: T[], f: (item: T) => boolean): T[]' >T</data-lsp></span><span style="color: #000000">[];</span></div><div class='line'><span style="color: #000000">};</span></div><div class='line'><span style="color: #0000FF">type</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='type AnotherFilter = &lt;T>(array: T[], f: (item: T) => boolean) => T[]' >AnotherFilter</data-lsp></span><span style="color: #000000"> = &lt;</span><span style="color: #267F99"><data-lsp lsp='(type parameter) T in &lt;T>(array: T[], f: (item: T) => boolean): T[]' >T</data-lsp></span><span style="color: #000000">&gt;(</span><span style="color: #001080"><data-lsp lsp='(parameter) array: T[]' >array</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='(type parameter) T in &lt;T>(array: T[], f: (item: T) => boolean): T[]' >T</data-lsp></span><span style="color: #000000">[], </span><span style="color: #795E26"><data-lsp lsp='(parameter) f: (item: T) => boolean' >f</data-lsp></span><span style="color: #000000">: (</span><span style="color: #001080"><data-lsp lsp='(parameter) item: T' >item</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='(type parameter) T in &lt;T>(array: T[], f: (item: T) => boolean): T[]' >T</data-lsp></span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #267F99">boolean</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='(type parameter) T in &lt;T>(array: T[], f: (item: T) => boolean): T[]' >T</data-lsp></span><span style="color: #000000">[];</span></div></code></div></pre>
<p>使用 <code>T extends Type</code> 的方式可以声明受限的泛型
在下面的 <code>mapNode</code> 函数声明中，如果仅使用 <code>T</code>，则无法从 <code>node</code> 中安全读取 <code>value</code> 属性，
若使用 <code>TreeNode</code> 不使用泛型，则返回值会丢失类型信息，统统为 <code>TreeNode</code> 类型</p>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">type</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='type TreeNode = {&#10;    value: string;&#10;}' >TreeNode</data-lsp></span><span style="color: #000000"> = {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #001080"><data-lsp lsp='(property) value: string' >value</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">};</span></div><div class='line'><span style="color: #0000FF">type</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='type LeafNode = TreeNode &amp; {&#10;    isLeaf: true;&#10;}' >LeafNode</data-lsp></span><span style="color: #000000"> = </span><span style="color: #267F99"><data-lsp lsp='type TreeNode = {&#10;    value: string;&#10;}' >TreeNode</data-lsp></span><span style="color: #000000"> & {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #001080"><data-lsp lsp='(property) isLeaf: true' >isLeaf</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">true</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">};</span></div><div class='line'><span style="color: #0000FF">type</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='type InnerNode = TreeNode &amp; {&#10;    children: [TreeNode] | [TreeNode, TreeNode];&#10;}' >InnerNode</data-lsp></span><span style="color: #000000"> = </span><span style="color: #267F99"><data-lsp lsp='type TreeNode = {&#10;    value: string;&#10;}' >TreeNode</data-lsp></span><span style="color: #000000"> & {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #001080"><data-lsp lsp='(property) children: [TreeNode] | [TreeNode, TreeNode]' >children</data-lsp></span><span style="color: #000000">: [</span><span style="color: #267F99"><data-lsp lsp='type TreeNode = {&#10;    value: string;&#10;}' >TreeNode</data-lsp></span><span style="color: #000000">] | [</span><span style="color: #267F99"><data-lsp lsp='type TreeNode = {&#10;    value: string;&#10;}' >TreeNode</data-lsp></span><span style="color: #000000">, </span><span style="color: #267F99"><data-lsp lsp='type TreeNode = {&#10;    value: string;&#10;}' >TreeNode</data-lsp></span><span style="color: #000000">];</span></div><div class='line'><span style="color: #000000">};</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='function mapNode&lt;T extends TreeNode>(node: T, f: (value: string) => string): T &amp; {&#10;    value: string;&#10;}' >mapNode</data-lsp></span><span style="color: #000000">&lt;</span><span style="color: #267F99"><data-lsp lsp='(type parameter) T in mapNode&lt;T extends TreeNode>(node: T, f: (value: string) => string): T &amp; {&#10;    value: string;&#10;}' >T</data-lsp></span><span style="color: #000000"> </span><span style="color: #0000FF">extends</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='type TreeNode = {&#10;    value: string;&#10;}' >TreeNode</data-lsp></span><span style="color: #000000">&gt;(</span><span style="color: #001080"><data-lsp lsp='(parameter) node: T extends TreeNode' >node</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='(type parameter) T in mapNode&lt;T extends TreeNode>(node: T, f: (value: string) => string): T &amp; {&#10;    value: string;&#10;}' >T</data-lsp></span><span style="color: #000000">, </span><span style="color: #795E26"><data-lsp lsp='(parameter) f: (value: string) => string' >f</data-lsp></span><span style="color: #000000">: (</span><span style="color: #001080"><data-lsp lsp='(parameter) value: string' >value</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #267F99">string</span><span style="color: #000000">) {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #AF00DB">return</span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">    ...</span><span style="color: #001080"><data-lsp lsp='(parameter) node: T extends TreeNode' >node</data-lsp></span><span style="color: #000000">,</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #001080"><data-lsp lsp='(property) value: string' >value</data-lsp>:</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='(parameter) f: (value: string) => string' >f</data-lsp></span><span style="color: #000000">(</span><span style="color: #001080"><data-lsp lsp='(parameter) node: T extends TreeNode' >node</data-lsp></span><span style="color: #000000">.</span><span style="color: #001080"><data-lsp lsp='(property) value: string' >value</data-lsp></span><span style="color: #000000">),</span></div><div class='line'><span style="color: #000000">  };</span></div><div class='line'><span style="color: #000000">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1"><data-lsp lsp='const fooNode: LeafNode' >fooNode</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='type LeafNode = TreeNode &amp; {&#10;    isLeaf: true;&#10;}' >LeafNode</data-lsp></span><span style="color: #000000"> = {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #001080"><data-lsp lsp='(property) value: string' >value</data-lsp>:</span><span style="color: #000000"> </span><span style="color: #A31515">"foo"</span><span style="color: #000000">,</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #001080"><data-lsp lsp='(property) isLeaf: true' >isLeaf</data-lsp>:</span><span style="color: #000000"> </span><span style="color: #0000FF">true</span><span style="color: #000000">,</span></div><div class='line'><span style="color: #000000">};</span></div><div class='line'><span style="color: #008000">// resultNode 的类型为 typeof fooNode & { value: string }</span></div><div class='line'><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1"><data-lsp lsp='const resultNode: TreeNode &amp; {&#10;    isLeaf: true;&#10;} &amp; {&#10;    value: string;&#10;}' >resultNode</data-lsp></span><span style="color: #000000"> = </span><span style="color: #795E26"><data-lsp lsp='function mapNode&lt;LeafNode>(node: LeafNode, f: (value: string) => string): TreeNode &amp; {&#10;    isLeaf: true;&#10;} &amp; {&#10;    value: string;&#10;}' >mapNode</data-lsp></span><span style="color: #000000">(</span><span style="color: #001080"><data-lsp lsp='const fooNode: LeafNode' >fooNode</data-lsp></span><span style="color: #000000">, (</span><span style="color: #001080"><data-lsp lsp='(parameter) value: string' >value</data-lsp></span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='(parameter) value: string' >value</data-lsp></span><span style="color: #000000">.</span><span style="color: #795E26"><data-lsp lsp='(method) String.slice(start?: number | undefined, end?: number | undefined): string' >slice</data-lsp></span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">));</span></div></code></div></pre>
<p>模拟变长参数（Exercise 4）</p>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='function call&lt;T extends [unknown, string, ...unknown[]], R>(f: (...args: T) => R, ...args: T): R' >call</data-lsp></span><span style="color: #000000">&lt;</span><span style="color: #267F99"><data-lsp lsp='(type parameter) T in call&lt;T extends [unknown, string, ...unknown[]], R>(f: (...args: T) => R, ...args: T): R' >T</data-lsp></span><span style="color: #000000"> </span><span style="color: #0000FF">extends</span><span style="color: #000000"> [</span><span style="color: #267F99">unknown</span><span style="color: #000000">, </span><span style="color: #267F99">string</span><span style="color: #000000">, ...</span><span style="color: #267F99">unknown</span><span style="color: #000000">[]], </span><span style="color: #267F99"><data-lsp lsp='(type parameter) R in call&lt;T extends [unknown, string, ...unknown[]], R>(f: (...args: T) => R, ...args: T): R' >R</data-lsp></span><span style="color: #000000">&gt;(</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #795E26"><data-lsp lsp='(parameter) f: (...args: T) => R' >f</data-lsp></span><span style="color: #000000">: (...</span><span style="color: #001080"><data-lsp lsp='(parameter) args: T extends [unknown, string, ...unknown[]]' >args</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='(type parameter) T in call&lt;T extends [unknown, string, ...unknown[]], R>(f: (...args: T) => R, ...args: T): R' >T</data-lsp></span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='(type parameter) R in call&lt;T extends [unknown, string, ...unknown[]], R>(f: (...args: T) => R, ...args: T): R' >R</data-lsp></span><span style="color: #000000">,</span></div><div class='line'><span style="color: #000000">  ...</span><span style="color: #001080"><data-lsp lsp='(parameter) args: T extends [unknown, string, ...unknown[]]' >args</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='(type parameter) T in call&lt;T extends [unknown, string, ...unknown[]], R>(f: (...args: T) => R, ...args: T): R' >T</data-lsp></span></div><div class='line'><span style="color: #000000">) {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='(parameter) f: (...args: T) => R' >f</data-lsp></span><span style="color: #000000">(...</span><span style="color: #001080"><data-lsp lsp='(parameter) args: T extends [unknown, string, ...unknown[]]' >args</data-lsp></span><span style="color: #000000">);</span></div><div class='line'><span style="color: #000000">}</span></div><div class='line'><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='function fill&lt;T>(length: number, value: T): T[]' >fill</data-lsp></span><span style="color: #000000">&lt;</span><span style="color: #267F99"><data-lsp lsp='(type parameter) T in fill&lt;T>(length: number, value: T): T[]' >T</data-lsp></span><span style="color: #000000">&gt;(</span><span style="color: #001080"><data-lsp lsp='(parameter) length: number' >length</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99">number</span><span style="color: #000000">, </span><span style="color: #001080"><data-lsp lsp='(parameter) value: T' >value</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='(type parameter) T in fill&lt;T>(length: number, value: T): T[]' >T</data-lsp></span><span style="color: #000000">) {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='var Array: ArrayConstructor' >Array</data-lsp></span><span style="color: #000000">.</span><span style="color: #795E26"><data-lsp lsp='(method) ArrayConstructor.from&lt;unknown, T>(iterable: Iterable&lt;unknown> | ArrayLike&lt;unknown>, mapfn: (v: unknown, k: number) => T, thisArg?: any): T[] (+3 overloads)' >from</data-lsp></span><span style="color: #000000">({ </span><span style="color: #001080"><data-lsp lsp='(property) ArrayLike&lt;T>.length: number' >length</data-lsp></span><span style="color: #000000"> }, () </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='(parameter) value: T' >value</data-lsp></span><span style="color: #000000">);</span></div><div class='line'><span style="color: #000000">}</span></div><div class='line'><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1"><data-lsp lsp='const fillArr: ""[]' >fillArr</data-lsp></span><span style="color: #000000"> = </span><span style="color: #795E26"><data-lsp lsp='function call&lt;[number, ""], ""[]>(f: (args_0: number, args_1: "") => ""[], args_0: number, args_1: ""): ""[]' >call</data-lsp></span><span style="color: #000000">(</span><span style="color: #001080"><data-lsp lsp='function fill&lt;T>(length: number, value: T): T[]' >fill</data-lsp></span><span style="color: #000000">, </span><span style="color: #098658">10</span><span style="color: #000000">, </span><span style="color: #A31515">""</span><span style="color: #000000">);</span></div></code></div></pre>
<p>泛型可以有默认类型。类似于函数的可选参数，有默认类型的泛型需要放在没有默认类型的泛型后面</p>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">type</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='type MyEvent&lt;Target extends HTMLElement = HTMLElement, Type = string> = {&#10;    target: Target;&#10;    type: Type;&#10;}' >MyEvent</data-lsp></span><span style="color: #000000">&lt;</span><span style="color: #267F99"><data-lsp lsp='(type parameter) Target in type MyEvent&lt;Target extends HTMLElement = HTMLElement, Type = string>' >Target</data-lsp></span><span style="color: #000000"> </span><span style="color: #0000FF">extends</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='interface HTMLElement' >HTMLElement</data-lsp></span><span style="color: #000000"> = </span><span style="color: #267F99"><data-lsp lsp='interface HTMLElement' >HTMLElement</data-lsp></span><span style="color: #000000">, </span><span style="color: #267F99"><data-lsp lsp='(type parameter) Type in type MyEvent&lt;Target extends HTMLElement = HTMLElement, Type = string>' >Type</data-lsp></span><span style="color: #000000"> = </span><span style="color: #267F99">string</span><span style="color: #000000">&gt; = {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #001080"><data-lsp lsp='(property) target: Target extends HTMLElement = HTMLElement' >target</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='(type parameter) Target in type MyEvent&lt;Target extends HTMLElement = HTMLElement, Type = string>' >Target</data-lsp></span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #001080"><data-lsp lsp='(property) type: Type = string' >type</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='(type parameter) Type in type MyEvent&lt;Target extends HTMLElement = HTMLElement, Type = string>' >Type</data-lsp></span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">};</span></div><div class='line'><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='let myEvent: MyEvent&lt;HTMLBodyElement, string>' >myEvent</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='type MyEvent&lt;Target extends HTMLElement = HTMLElement, Type = string> = {&#10;    target: Target;&#10;    type: Type;&#10;}' >MyEvent</data-lsp></span><span style="color: #000000">&lt;</span><span style="color: #267F99"><data-lsp lsp='interface HTMLBodyElement' >HTMLBodyElement</data-lsp></span><span style="color: #000000">&gt; = {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #001080"><data-lsp lsp='(property) target: HTMLBodyElement' >target</data-lsp>:</span><span style="color: #000000"> &lt;</span><span style="color: #267F99"><data-lsp lsp='interface HTMLBodyElement' >HTMLBodyElement</data-lsp></span><span style="color: #000000">&gt;</span><span style="color: #001080"><data-lsp lsp='var document: Document' >document</data-lsp></span><span style="color: #000000">.</span><span style="color: #001080"><data-lsp lsp='(property) Document.body: HTMLElement' >body</data-lsp></span><span style="color: #000000">,</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #001080"><data-lsp lsp='(property) type: string' >type</data-lsp>:</span><span style="color: #000000"> </span><span style="color: #A31515">"click"</span><span style="color: #000000">,</span></div><div class='line'><span style="color: #000000">};</span></div></code></div></pre>
<p>Exercise 5</p>
<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">ts</div><div class='code-container'><code><div class='line'><span style="color: #0000FF">type</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='type Is = &lt;T>(valueA: T, valueB: T) => boolean' >Is</data-lsp></span><span style="color: #000000"> = &lt;</span><span style="color: #267F99"><data-lsp lsp='(type parameter) T in &lt;T>(valueA: T, valueB: T): boolean' >T</data-lsp></span><span style="color: #000000">&gt;(</span><span style="color: #001080"><data-lsp lsp='(parameter) valueA: T' >valueA</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='(type parameter) T in &lt;T>(valueA: T, valueB: T): boolean' >T</data-lsp></span><span style="color: #000000">, </span><span style="color: #001080"><data-lsp lsp='(parameter) valueB: T' >valueB</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='(type parameter) T in &lt;T>(valueA: T, valueB: T): boolean' >T</data-lsp></span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #267F99">boolean</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='const is: Is' >is</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='type Is = &lt;T>(valueA: T, valueB: T) => boolean' >Is</data-lsp></span><span style="color: #000000"> = (</span><span style="color: #001080"><data-lsp lsp='(parameter) a: T' >a</data-lsp></span><span style="color: #000000">, </span><span style="color: #001080"><data-lsp lsp='(parameter) b: T' >b</data-lsp></span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='(parameter) a: T' >a</data-lsp></span><span style="color: #000000"> === </span><span style="color: #001080"><data-lsp lsp='(parameter) b: T' >b</data-lsp></span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">};</span></div><div class='line'><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1"><data-lsp lsp='const equal: boolean' >equal</data-lsp></span><span style="color: #000000"> = </span><span style="color: #795E26"><data-lsp lsp='const is: &lt;string>(valueA: string, valueB: string) => boolean' >is</data-lsp></span><span style="color: #000000">(</span><span style="color: #A31515">"a"</span><span style="color: #000000">, </span><span style="color: #A31515">"b"</span><span style="color: #000000">);</span></div><div class='line'><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1"><data-lsp lsp='const equal2: boolean' >equal2</data-lsp></span><span style="color: #000000"> = </span><span style="color: #795E26"><data-lsp lsp='const is: &lt;number>(valueA: number, valueB: number) => boolean' >is</data-lsp></span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">, </span><span style="color: #098658">2</span><span style="color: #000000">);</span></div><div class='line'><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1"><data-lsp lsp='const err: boolean' >err</data-lsp></span><span style="color: #000000"> = </span><span style="color: #795E26"><data-lsp lsp='const is: &lt;string>(valueA: string, valueB: string) => boolean' >is</data-lsp></span><span style="color: #000000">(</span><span style="color: #A31515">"1"</span><span style="color: #000000">, </span><span style="color: #098658"><data-err>2</data-err></span><span style="color: #000000">);</span></div><span class="error"><span>Argument of type 'number' is not assignable to parameter of type 'string'.</span><span class="code">2345</span></span><span class="error-behind">Argument of type 'number' is not assignable to parameter of type 'string'.</span><div class='line'>&nbsp;</div><div class='line'><span style="color: #0000FF">type</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='type MultiplyIs = &lt;T>(...args: T[]) => boolean' >MultiplyIs</data-lsp></span><span style="color: #000000"> = &lt;</span><span style="color: #267F99"><data-lsp lsp='(type parameter) T in &lt;T>(...args: T[]): boolean' >T</data-lsp></span><span style="color: #000000">&gt;(...</span><span style="color: #001080"><data-lsp lsp='(parameter) args: T[]' >args</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='(type parameter) T in &lt;T>(...args: T[]): boolean' >T</data-lsp></span><span style="color: #000000">[]) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #267F99">boolean</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='const multiplyIs: MultiplyIs' >multiplyIs</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='type MultiplyIs = &lt;T>(...args: T[]) => boolean' >MultiplyIs</data-lsp></span><span style="color: #000000"> = (...</span><span style="color: #001080"><data-lsp lsp='(parameter) args: T[]' >args</data-lsp></span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #AF00DB">for</span><span style="color: #000000"> (</span><span style="color: #0000FF">let</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='let i: number' >i</data-lsp></span><span style="color: #000000"> = </span><span style="color: #098658">1</span><span style="color: #000000">, </span><span style="color: #001080"><data-lsp lsp='let len: number' >len</data-lsp></span><span style="color: #000000"> = </span><span style="color: #001080"><data-lsp lsp='(parameter) args: T[]' >args</data-lsp></span><span style="color: #000000">.</span><span style="color: #001080"><data-lsp lsp='(property) Array&lt;T>.length: number' >length</data-lsp></span><span style="color: #000000">; </span><span style="color: #001080"><data-lsp lsp='let i: number' >i</data-lsp></span><span style="color: #000000"> &lt; </span><span style="color: #001080"><data-lsp lsp='let len: number' >len</data-lsp></span><span style="color: #000000">; </span><span style="color: #001080"><data-lsp lsp='let i: number' >i</data-lsp></span><span style="color: #000000">++) {</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080"><data-lsp lsp='(parameter) args: T[]' >args</data-lsp></span><span style="color: #000000">[</span><span style="color: #001080"><data-lsp lsp='let i: number' >i</data-lsp></span><span style="color: #000000">] !== </span><span style="color: #001080"><data-lsp lsp='(parameter) args: T[]' >args</data-lsp></span><span style="color: #000000">[</span><span style="color: #001080"><data-lsp lsp='let i: number' >i</data-lsp></span><span style="color: #000000"> - </span><span style="color: #098658">1</span><span style="color: #000000">]) {</span></div><div class='line'><span style="color: #000000">      </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #0000FF">false</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">    }</span></div><div class='line'><span style="color: #000000">  }</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #0000FF">true</span><span style="color: #000000">;</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #008000">// 另一种不好读的方式</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #008000">// args.reduce((accumulator, current, index) =&gt; {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #008000">//   if (index !== 0 && current !== args[index - 1]) {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #008000">//     return false;</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #008000">//   }</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #008000">//   return accumulator;</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #008000">// }, true)</span></div><div class='line'><span style="color: #000000">};</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1"><data-lsp lsp='const mEqual: boolean' >mEqual</data-lsp></span><span style="color: #000000"> = </span><span style="color: #795E26"><data-lsp lsp='const multiplyIs: &lt;string>(...args: string[]) => boolean' >multiplyIs</data-lsp></span><span style="color: #000000">([</span><span style="color: #098658">1</span><span style="color: #000000">], </span><span style="color: #A31515">""</span><span style="color: #000000">, [</span><span style="color: #098658">1</span><span style="color: #000000">, </span><span style="color: #098658">2</span><span style="color: #000000">, </span><span style="color: #098658">3</span><span style="color: #000000">]);</span></div><span class="error"><span>Argument of type 'number[]' is not assignable to parameter of type 'string'.</span><span class="code">2345</span></span><span class="error-behind">Argument of type 'number[]' is not assignable to parameter of type 'string'.</span></code></div></pre>